<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plotly.js Combined Line and Bar Plot</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <div id="combined-plot"></div>

    <script>
        const data = [
            {connection: "1", data: [1.1, 1.2]},
            {connection: "2", data: [1.15, 1.05]},
            {connection: "3", data: [1.2, 1.1]},
            {connection: "4", data: [1.25, 1.15]},
            {connection: "5", data: [1.3, 1.2]},
        ];

        const lineData = data.map((d, i) => {
            return {
                x: [`(Up)`, `(Down)`],
                y: d.data,
                mode: 'lines+markers',
                type: 'scatter',
                name: `Connection ${d.connection}`,
                line: {shape: 'linear'},
                marker: {size: 8},
            };
        });

        const upAvg = data.reduce((sum, d) => sum + d.data[0], 0) / data.length;
        const downAvg = data.reduce((sum, d) => sum + d.data[1], 0) / data.length;

        const barData = [
            {
                x: ['(Up)'],
                y: [upAvg],
                type: 'bar',
                name: 'Average Up'
            },
            {
                x: ['(Down)'],
                y: [downAvg],
                type: 'bar',
                name: 'Average Down'
            }
        ];

        const combinedData = [...lineData, ...barData];

        const layout = {
            title: 'Combined Width Percent Line and Bar Plot',
            xaxis: {title: 'Connection'},
            yaxis: {title: 'Width Percent'},
            showlegend: true,
            barmode: 'group',
        };

        Plotly.newPlot('combined-plot', combinedData, layout);
    </script>
</body>
</html>
